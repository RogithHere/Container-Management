<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Container Management</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/css/multi-select-tag.css">
    <!-- Your Custom CSS -->
    <style>
        body {
            background-color: #f8f9fa;
        }

        .navbar {
            background-color: #007bff;
            height: 100px;
            font-size: 25px;
            color:#ffffff ;
        }

        .navbar-dark .navbar-nav .nav-link {
            color: #ffffff;
            border: 5px;
            border-color: black;
        }

        .navbar-dark .navbar-toggler-icon {
            background-color: #ffffff;
        }
        .navbar-brand{
            font-size: 35px;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }

        .navbar-dark .navbar-toggler {
            border-color: #ffffff;
        }

        .navbar-dark .navbar-toggler:hover,
        .navbar-dark .navbar-toggler:focus {
            background-color: #0056b3;
        }

        .active {
            background-color: #0056b3 !important;
        }
        
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark ">
    <a class="navbar-brand">Container Management</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/main" >Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/purchase" >Purchase</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/sell" >Sell</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="/lease" >Lease</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/transactions" >Transactions</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/customer" >Customers</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-5" id="lease">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">lease Container</h4>
        </div>
    <form id="leaseForm" class="card-body" >
        <div class="form-group">
            <label for="customer">Customer:</label>
            <input type="text" class="form-control" id="customer" name="customer" placeholder="Customer Name" required>
            <input type="email" class="form-control" id="customer_email" name="customer_email" placeholder="Customer Email" required>
            <input type="text" class="form-control" id="customer_contact" name="customer_contact" placeholder="Customer Contact" required>
        </div>

        <div class="form-group">
            <label for="port">Available Containers:</label>
            <select class="custom-select" id="leaseMultiContainer" name="select" multiple multiselect-search="true">
            
            </select>
        </div>

        <div class="form-group" id="container-prices">
            
        </div>
        <div class="form-group">
            <label for="amount">Amount:</label>
            <input type="number" class="form-control" id="amount" name="amount" readonly required>
        </div>
        <div class="form-group">
            <label for="fromDate"> From:</label>
            <input type="date" class="form-control" id="fromDate" name="date" required>
        </div>
        <div class="form-group">
            <label for="toDate">To:</label>
            <input type="date" class="form-control" id="toDate" name="date" required>
        </div>
        <div class="form-group">
            <label for="port">Port:</label>
            <select id="port" name="port" class="custom-select">
            <option selected value="">Select Port</option>
            <option value="Mumbai port">Mumbai port,Maharastra</option>
            <option value="Chennai port">Chennai port,Tamilnadu</option>
            <option value="Kolkata port">Kolkata port,West Bengal</option>
            <option value="Cochin port">Cochin port,Kerala</option>
            <option value="Visakhapatnam port">Visakhapatnam port,Andhra Pradesh</option>
            <option value="Kandla port">Kandla port,Gujarat</option>
            <option value="Jawaharlal Nehru port">Jawaharlal Nehru port,Maharastra</option>
            <option value="Marmagao port">Marmagao port,Goa</option>
            <option value="New Mangalore port">New Mangalore port,Karnataka</option>
            <option value="Haldia port">Haldia port,West Bengal</option>
            <option value="Ennore port">Ennore port,Tamilnadu</option>
            <option value="Thoothukudi port">Thoothukudi port,Tamilnadu</option>

        </select>
        </div>
        <div class="form-group">
            <label for="">Invoice Number:</label>
            <input type="text" class="form-control" id="invoice" name="invoice" placeholder="Enter the invoice number" required>
        </div>

        <button type="button" onclick="confirmLease()" class="btn btn-primary">Submit</button>
    </form>
</div>
</div>
<div class="container mt-5">
    <div class="card lease" style="display: none;">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Lease Invoice</h4>
        </div>
        <div class="card-body">
            <!-- Seller Details -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Customer Details:</h5>
                    <p id="CustomerDetails">Customer Details Name<br>Email<br>Contact</p>
                </div>
            </div>

            <!-- Purchase Details -->
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Size</th>
                            <th>Container ID</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="leaseDetailsBody">
                        <!-- Purchase details will be dynamically added here -->
                    </tbody>
                </table>
            </div>

            <!-- Port, Date, Invoice Number -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <h5>Port:</h5>
                    <p id="portDetails">Port Name</p>
                </div>
                <div class="col-md-6 text-right">
                    <h5>From Date:</h5>
                    <p id="fromDateDetails">Date</p>
                    <h5>To Date:</h5>
                    <p id="toDateDetails">Date</p> <!-- Add this line for To Date -->
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <h5>Invoice Number:</h5>
                    <p id="invoiceDetails">Invoice Number</p>
                </div>
            </div>

            <!-- Total Cost -->
            <div class="row mt-4">
                <div class="col-md-12 text-right">
                    <h5>Total Cost:</h5>
                    <p id="totalCost">Total Cost</p>
                </div>
            </div>
        </div>
        <button type="button" onclick="window.location.href='/main'" class="btn btn-primary">Submit</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/js/multi-select-tag.js"></script>
<script src="/static/main.js" type="text/javascript"></script>

<script>
    var leaseSelectElement;

document.addEventListener('DOMContentLoaded', function () {
    leaseSelectElement = document.getElementById('leaseMultiContainer');

    if (leaseSelectElement) {
        fetch('/container-details')
            .then(response => response.json())
            .then(data => {
                if (data.containers) {
                    console.log(data.containers);

                    // Clear existing options from the select element
                    leaseSelectElement.innerHTML = '';

                    data.containers.forEach(containerData => {
                        // Create a new option
                        var option = document.createElement('option');
                        option.value = `${containerData.idno}-${containerData.type}-${containerData.size}`;
                        option.text = `${containerData.idno}-${containerData.type}-${containerData.size} feet`;

                        // Append the option to the select element
                        leaseSelectElement.appendChild(option);

                        console.log("Should have inserted:", option.value, option.text);
                    });

                    // Refresh the MultiselectDropdown for the target select element
                    if (window.MultiselectDropdown && leaseSelectElement.refreshDropdown) {
                        leaseSelectElement.refreshDropdown();
                    } else {
                        refreshMultiselectDropdown(leaseSelectElement);
                    }
                } else {
                    console.error('Containers data is undefined or not an array:', data);
                }
            })
            .catch(error => console.error('Error fetching data:', error));
    } else {
        console.error('The select element with id "multiContainer" was not found.');
    }
});

// Function to refresh the MultiselectDropdown for the target select element
function refreshMultiselectDropdown(leaseSelectElement) {
    if (window.MultiselectDropdown) {
        var multiselectDropdown = window.MultiselectDropdownOptions || {};
        multiselectDropdown.searchInput = { class: 'form-control' };
        multiselectDropdown.txtSearch = 'Search';
        multiselectDropdown.placeholder = 'Select';
        multiselectDropdown.height = '15rem';

        // Check if MultiselectDropdown is already initialized for the target element
        var existingDropdown = leaseSelectElement.parentElement && leaseSelectElement.parentElement.querySelector('.multiselect-dropdown');
        if (!existingDropdown) {
            // Create the MultiselectDropdown for the target select element
            new MultiselectDropdown({
                ...multiselectDropdown,
                targetElement: leaseSelectElement
            });
        }
    }
}

// Extending the refreshDropdown function for dynamic addition of options
HTMLSelectElement.prototype.refreshDropdown = function () {
    this.loadOptions();
    refreshMultiselectDropdown(this);
};

// Trigger refreshMultiselectDropdown when window is loaded
window.addEventListener('load', function () {
    refreshMultiselectDropdown(leaseSelectElement);
});


var leaseSelectedContainers;

document.addEventListener('DOMContentLoaded', function () {
    var el = document.getElementById('leaseMultiContainer'); // Replace 'multiContainer' with the actual ID of your select element
    var containerPricesDiv = document.getElementById('container-prices'); // Replace 'container-prices' with the actual ID of your div
    var amountInput = document.getElementById('amount');

    el.addEventListener('change', function () {
        // Update the selectedSellContainers array
        leaseSelectedContainers = Array.from(el.selectedOptions).map(option => option.value);

        // Clear existing content in the div
        containerPricesDiv.innerHTML = '';

        // Loop through the selected values and create a label and text box for each value
        leaseSelectedContainers.forEach(function (selectedValue) {
            // Create a label
            var label = document.createElement('label');
            label.textContent = selectedValue;

            // Create a text box
            var textBox = document.createElement('input');
            textBox.type = 'number';
            textBox.placeholder = `Price of ${selectedValue}`;
            textBox.className = 'form-control'; // Add any additional classes if needed
            textBox.id=selectedValue;

            textBox.addEventListener('input', function () {
                updateTotal(); // Update the total value whenever a text box changes
            });


            // Append the label and text box to the "container-prices" div
            containerPricesDiv.appendChild(label);
            containerPricesDiv.appendChild(textBox);
        });

        updateTotal();
    });
   
    function updateTotal() {
        var total = 0;

        // Loop through all dynamically created text boxes and add their values to the total
        containerPricesDiv.querySelectorAll('input[type="number"]').forEach(function (textBox) {
            var value = parseFloat(textBox.value) || 0; // Parse float or default to 0
            total += value;
        });

        // Update the amount input with the calculated total
        amountInput.value = total.toFixed(2);
    }
});


</script>
</body>
</html>
